Процедура ПередЗаписью(Отказ, Замещение)

	Если ОбменДанными.Загрузка Тогда

		Возврат;

	КонецЕсли;

	Для каждого ЗаписьНабора Из ЭтотОбъект Цикл

		ЗаписьНабора.ДатаИзменения = ТекущаяДата();

		Если ЗаписьНабора.ДатаДокумента = '00010101' Тогда

			УстановитьДатуДокумента(ЗаписьНабора);

		КонецЕсли;

	КонецЦикла;

КонецПроцедуры

Процедура УстановитьДатуДокумента(ЗаписьНабора)	//	LNK 05.10.2020 06:01:52

	Если НЕ ЗначениеЗаполнено(ЗаписьНабора.СчетНаОплатуПокупателю) Тогда

		Возврат;

	КонецЕсли;

	Запрос = Новый Запрос(
	"ВЫБРАТЬ
	|	ТаблицаДокумента.Дата КАК Дата
	|ИЗ
	|	Документ.СчетНаОплатуПокупателю КАК ТаблицаДокумента
	|ГДЕ
	|	ТаблицаДокумента.Ссылка = &СчетНаОплатуПокупателю"
	);
	Запрос.УстановитьПараметр("СчетНаОплатуПокупателю", ЗаписьНабора.СчетНаОплатуПокупателю);
	
	Выборка = Запрос.Выполнить().Выбрать();
	
	Если Выборка.Следующий() Тогда

		ЗаписьНабора.ДатаДокумента = Выборка.Дата;

	КонецЕсли;

КонецПроцедуры



