
&НаСервере
Процедура ПередЗаписьюНаСервере(Отказ, ТекущийОбъект, ПараметрыЗаписи)
	Если ТекущийОбъект.ОсновноеМестоРаботы тогда 
		Сотрудник = ОбщегоНазначения.ЗначениеРеквизитаОбъекта(ТекущийОбъект.Сотрудник, "Сотрудник");
		ЕстьЗапись = ПроверитьОсновноеМестоРаботы(Сотрудник);
	 	Если  ЕстьЗапись тогда
			Сообщить("Уже существкует запись с основным местом работы!");
			Отказ = Истина; 
		КонецЕсли; 
	КонецЕсли;
КонецПроцедуры


Функция  ПроверитьОсновноеМестоРаботы(сотрудник)
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ
		|	Таб.РаботаВыполняемаяСотрудниками
		|ИЗ
		|	РегистрСведений.РаботаВыполняемаяСотрудниками КАК Таб
		|ГДЕ
		|	Таб.Сотрудник = &Сотрудник
		|	И Таб.ОсновноеМестоРаботы = ИСТИНА";
	
	Запрос.УстановитьПараметр("Сотрудник", Сотрудник);
	
	РезультатЗапроса = Запрос.Выполнить();
	Если РезультатЗапроса.Пустой() тогда
		Возврат Ложь;
	Иначе
		Возврат Истина;
	КонецЕсли;
		
КонецФункции