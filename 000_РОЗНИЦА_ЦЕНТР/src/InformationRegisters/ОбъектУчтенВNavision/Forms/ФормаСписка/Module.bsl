
&НаКлиенте
Процедура СписокПередУдалением(Элемент, Отказ)

	Если ИзменениеРазрешено(Отказ) Тогда

		Если НЕ Элемент.ТекущиеДанные = Неопределено Тогда

			Если Элемент.ТекущиеДанные.УчтеноNavision
			ИЛИ  Элемент.ТекущиеДанные.ВидПередачи = ПредопределенноеЗначение("Перечисление.ВидыПередачиNavision.ПолученИзNavision") Тогда

				ОчиститьСообщения();
				Сообщить("Удаление записи невозможно - это внешняя отметка! Отказано.");
				Отказ = Истина;

			КонецЕсли;

			Если НЕ Отказ Тогда

				РегистрацияУдаленияЗаписи(Элемент.ТекущиеДанные.Объект, Элемент.ТекущиеДанные.Магазин);

			КонецЕсли;

		КонецЕсли;

	КонецЕсли;

КонецПроцедуры

&НаКлиенте
Процедура СписокПередНачаломДобавления(Элемент, Отказ, Копирование, Родитель, Группа, Параметр)

	Отказ = Истина;

КонецПроцедуры

&НаКлиенте
Процедура СписокПередНачаломИзменения(Элемент, Отказ)

	ИзменениеРазрешено(Отказ);

КонецПроцедуры

&НаСервере
Функция ИзменениеРазрешено(Отказ)

	Если НЕ ТехническаяПоддержкаВызовСервера.ИсключительныйРежим() = Истина Тогда

		Отказ = Истина;
		Сообщить("Не установлен режим разрешения! Отказано.");

	КонецЕсли;

	Возврат НЕ Отказ;

КонецФункции // ИзменениеРазрешено()

&НаСервере
Процедура РегистрацияУдаленияЗаписи(Объект, Магазин)

	ЖурналСобытий.Регистрация("ОбъектУчтенВNavision.Удаление", УровеньЖурналаРегистрации.Предупреждение
	, Объект.Метаданные(), Объект,
	, "Удалена запись по магазину «" + Магазин + "»", СокрЛП(Объект), Истина);

КонецПроцедуры

&НаКлиенте	//	LNK 11.09.2020 08:08:04
Процедура СписокПослеУдаления(Элемент)

	Оповестить("ИзменениеОбъектУчтенВNavision");

КонецПроцедуры

&НаКлиенте	//	LNK 11.09.2020 08:09:54
Процедура СписокПриОкончанииРедактирования(Элемент, НоваяСтрока, ОтменаРедактирования)

	Оповестить("ИзменениеОбъектУчтенВNavision");

КонецПроцедуры



