
&НаКлиенте
Процедура ПередЗаписью(Отказ, ПараметрыЗаписи)

	Если НЕ ЗначениеЗаполнено(Объект.Ссылка) И Объект.ТипШаблона = ПредопределенноеЗначение("Перечисление.ТипыШаблоновЧеков.ЧекККМ") Тогда
		Отказ = ПередЗаписьюПроверить(Объект.Магазин);
		Если Отказ Тогда
			Сообщение = Новый СообщениеПользователю;
			Сообщение.Текст = "Шаблон для магазина "+ Объект.Магазин + " уже существует, следует редактировать его. Один магазин - один элемент.";
			Сообщение.Сообщить(); 
		КонецЕсли; 
	КонецЕсли; 

КонецПроцедуры

&НаСервереБезКонтекста
Функция ПередЗаписьюПроверить(Магазин)
	
	Запрос = Новый Запрос(
	"ВЫБРАТЬ
	|	ШаблоныЧеков.Ссылка КАК Ссылка
	|ИЗ
	|	Справочник.ШаблоныЧеков КАК ШаблоныЧеков
	|ГДЕ
	|	ШаблоныЧеков.Магазин = &Магазин
	|	И ШаблоныЧеков.ТипШаблона = ЗНАЧЕНИЕ(Перечисление.ТипыШаблоновЧеков.ЧекККМ)"
	);
	
	Запрос.УстановитьПараметр("Магазин", Магазин);
	Запрос.УстановитьПараметр("ТипШаблона", Перечисления.ТипыШаблоновЧеков.ЧекККМ);
	РезультатЗапроса = Запрос.Выполнить();
	
	Если НЕ РезультатЗапроса.Пустой() Тогда
		Возврат Истина;
	Иначе
		Возврат Ложь
	КонецЕсли; 
	
КонецФункции

&НаКлиенте
Процедура ВставитьТелефонДиректора(Команда)

	ВставитьМнемоимя("#DIRPHONE#");

КонецПроцедуры

&НаКлиенте
Процедура ВставитьСерийныйНомер(Команда)

	ВставитьМнемоимя("#SERIALNUM#");

КонецПроцедуры

&НаКлиенте
Процедура ВставитьМнемоимя(Мнемоимя)

	Если НЕ Элементы.СтрокиПодвала.ТекущаяСтрока = Неопределено Тогда

		ТекущиеДанные = Объект.СтрокиПодвала.НайтиПоИдентификатору(Элементы.СтрокиПодвала.ТекущаяСтрока);
		ТекущиеДанные.Строка = СокрЛП(СокрЛП(ТекущиеДанные.Строка) + " " + Мнемоимя);

	КонецЕсли;

КонецПроцедуры
