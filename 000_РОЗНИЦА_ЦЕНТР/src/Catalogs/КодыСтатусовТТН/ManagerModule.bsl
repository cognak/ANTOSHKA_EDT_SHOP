#Если Сервер Или ТолстыйКлиентОбычноеПриложение Или ВнешнееСоединение Тогда

#Область ПрограммныйИнтерфейс

// Получить статус.
// 
// Параметры:
//  СтруктураСтатуса - Структура - Структура статуса
// 
// Возвращаемое значение:
//  СправочникСсылка.КодыСтатусовТТН - Получить статус
Функция ПолучитьСтатус(СтруктураСтатуса) Экспорт

	Запрос = Новый Запрос;
	Запрос.Текст =
		"ВЫБРАТЬ
		|	КодыСтатусовТТН.Ссылка
		|ИЗ
		|	Справочник.КодыСтатусовТТН КАК КодыСтатусовТТН
		|ГДЕ
		|	КодыСтатусовТТН.Код = &КодСтатуса
		|	И КодыСтатусовТТН.ОператорДоставки = &ОператорДоставки";
	
	Запрос.УстановитьПараметр("КодСтатуса", СтруктураСтатуса.КодСтатуса);
	Запрос.УстановитьПараметр("ОператорДоставки", СтруктураСтатуса.ОператорДоставки);
	
	РезультатЗапроса = Запрос.Выполнить();
	
	Выборка = РезультатЗапроса.Выбрать();
	
	Если Выборка.Следующий() Тогда
		
		Результат = Выборка.Ссылка;
		
	Иначе
		
		НовыйЭлемент = СоздатьЭлемент();
		НовыйЭлемент.Код = СтруктураСтатуса.КодСтатуса;
		НовыйЭлемент.Наименование = СтруктураСтатуса.Наименование;
		НовыйЭлемент.НаименованиеСтатуса = СтруктураСтатуса.Наименование;
		НовыйЭлемент.ОператорДоставки = СтруктураСтатуса.ОператорДоставки;
		НовыйЭлемент.СтатусПосылки = Перечисления.СтатусыПосылокСлужбыДоставки.ВДороге;
		НовыйЭлемент.Записать();
		Результат = НовыйЭлемент.Ссылка;
		
	КонецЕсли;
	
	Возврат Результат;

КонецФункции

// Код процедур и функций
#КонецОбласти

#Область ОбработчикиСобытий
// Код процедур и функций
#КонецОбласти

#Область СлужебныйПрограммныйИнтерфейс
// Код процедур и функций
#КонецОбласти

#Область СлужебныеПроцедурыИФункции
// Код процедур и функций
#КонецОбласти

#КонецЕсли