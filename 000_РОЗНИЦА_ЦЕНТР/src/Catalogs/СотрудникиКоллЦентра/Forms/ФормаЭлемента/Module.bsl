
#Область ОписаниеПеременных

#КонецОбласти

#Область ОбработчикиСобытийФормы

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	Если Не Параметры.ЗначенияЗаполнения.Количество() = 0 И СотрудникЕстьВБазе(Объект.Владелец) Тогда
		ТекстСообщения = НСтр("ru='Сотрудник уже есть в базе.'");
		ОбщегоНазначенияКлиентСервер.СообщитьПользователю(
			ТекстСообщения,
			,
			"Объект.Владелец");
			
        Отказ = Истина;
		СтандартнаяОбработка = Ложь;
		
	КонецЕсли;
		
	Если НЕ Параметры.ЗначениеКопирования.Пустая() Тогда
        Отказ = Истина;
		СтандартнаяОбработка = Ложь;
	КонецЕсли;
	
	Если Объект.Владелец.Пустая() Тогда 
		Элементы.Сотрудник.ТолькоПросмотр = Ложь;
	Иначе 
		Элементы.Сотрудник.ТолькоПросмотр = Истина;
	КонецЕсли;
КонецПроцедуры

&НаКлиенте
Процедура ПередЗаписью(Отказ, ПараметрыЗаписи)
	Если ПустаяСтрока(Объект.Наименование) Тогда
		Объект.Наименование = Строка(Объект.Владелец);
	КонецЕсли;
КонецПроцедуры

#КонецОбласти

#Область ОбработчикиСобытийЭлементовШапкиФормы

&НаКлиенте
Процедура СотрудникОбработкаВыбора(Элемент, ВыбранноеЗначение, СтандартнаяОбработка)
	Если СотрудникЕстьВБазе(ВыбранноеЗначение) Тогда
		ТекстСообщения = НСтр("ru='Сотрудник уже есть в базе.'");
		ОбщегоНазначенияКлиентСервер.СообщитьПользователю(
			ТекстСообщения,
			,
			"Объект.Владелец");
			
		ВыбранноеЗначение = "";
	Иначе 
		Элементы.Сотрудник.ТолькоПросмотр = Истина;
	КонецЕсли;
КонецПроцедуры

#КонецОбласти

#Область ОбработчикиКомандФормы

&НаКлиенте
Процедура ЗаполнитьФИО(Команда)
	Объект.Наименование = Строка(Объект.Владелец);
КонецПроцедуры

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

&НаСервере
Функция СотрудникЕстьВБазе(ИскомыйСотрудник)
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ
		|	СотрудникиКоллЦентра.Ссылка КАК Ссылка
		|ИЗ
		|	Справочник.СотрудникиКоллЦентра КАК СотрудникиКоллЦентра
		|ГДЕ
		|	СотрудникиКоллЦентра.Владелец = &Владелец";
	
	Запрос.УстановитьПараметр("Владелец", ИскомыйСотрудник);
	
	Возврат Не Запрос.Выполнить().Пустой();
	
КонецФункции // СотрудникЕстьВБазе()

#КонецОбласти